/* Example code to run the LW Lapse 3D printed turntable with NEMA bipolar stepper motor in Timelapse mode, more info available here: https://bit.ly/YoutubeTurntable */

#include <AccelStepper.h>

#define STEP_PIN 2     // Define the step pin connected to the CNC shield
#define DIR_PIN 5      // Define the direction pin connected to the CNC shield
#define ENABLE_PIN 8   // Define the enable pin connected to the CNC shield
#define PULSE_PIN 12   // Define the output pin to trigger for 125ms

AccelStepper stepper(AccelStepper::DRIVER, STEP_PIN, DIR_PIN);

void setup() {
  pinMode(PULSE_PIN, OUTPUT);
  digitalWrite(ENABLE_PIN, LOW); // Enable the driver (active low)
  stepper.setMaxSpeed(2000);     // Set the maximum speed (steps per second)
  stepper.setAcceleration(1000); // Set the acceleration (steps per second per second)
}

void loop() {
  digitalWrite(PULSE_PIN, HIGH); // Trigger the output pin HIGH
  delay(125);                     // Wait for 125ms
  digitalWrite(PULSE_PIN, LOW);  // Trigger the output pin LOW
  delay(2875);                   // Pause for exposure

  stepper.move(7);             // Stepper motor steps per interval, one table rotation is 20677 steps
  stepper.runToPosition();       // Wait for the motor to reach the target position
  delay(127000);                   // Interval in Milliseconds excluding settling delay and trigger time, total 3 seconds, ie for 2 min interval use 117000
}
